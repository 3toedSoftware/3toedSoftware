<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Test SVG Renderer - Thumbnail Slayer</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                padding: 20px;
                background: #1a1a1a;
                color: #fff;
            }
            .test-container {
                max-width: 1200px;
                margin: 0 auto;
            }
            .test-section {
                margin: 30px 0;
                padding: 20px;
                background: #2a2a2a;
                border-radius: 8px;
            }
            .renderer-output {
                display: flex;
                gap: 20px;
                margin-top: 20px;
            }
            .output-box {
                flex: 1;
                padding: 20px;
                background: #333;
                border-radius: 4px;
                text-align: center;
            }
            .output-box h3 {
                margin-top: 0;
            }
            #canvas-output,
            #svg-output {
                background: white;
                border: 2px solid #555;
                display: inline-block;
                margin-top: 10px;
            }
            .status {
                padding: 10px;
                border-radius: 4px;
                margin: 10px 0;
            }
            .status.success {
                background: #2d5a2d;
            }
            .status.error {
                background: #5a2d2d;
            }
            .status.warning {
                background: #5a4f2d;
            }
            button {
                background: #4caf50;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                margin: 5px;
            }
            button:hover {
                background: #45a049;
            }
        </style>
    </head>
    <body>
        <div class="test-container">
            <h1>SVG Renderer Test Suite</h1>

            <div class="test-section">
                <h2>Test 1: Module Import Test</h2>
                <button onclick="testModuleImports()">Test CDN Imports</button>
                <div id="import-status"></div>
            </div>

            <div class="test-section">
                <h2>Test 2: Font Warning Test</h2>
                <button onclick="testFontWarning()">Test Font Not Found Warning</button>
                <div class="renderer-output">
                    <div class="output-box">
                        <h3>SVG Output (No Font)</h3>
                        <div id="svg-no-font"></div>
                    </div>
                </div>
                <div id="font-status"></div>
            </div>

            <div class="test-section">
                <h2>Test 3: Renderer Comparison</h2>
                <button onclick="testBothRenderers()">Compare Canvas vs SVG</button>
                <div class="renderer-output">
                    <div class="output-box">
                        <h3>Canvas Renderer</h3>
                        <div id="canvas-output"></div>
                    </div>
                    <div class="output-box">
                        <h3>SVG Renderer</h3>
                        <div id="svg-output"></div>
                    </div>
                </div>
                <div id="comparison-status"></div>
            </div>
        </div>

        <script type="module">
            // Make functions globally available
            window.testModuleImports = async function () {
                const statusDiv = document.getElementById('import-status');
                statusDiv.innerHTML = '<div class="status warning">Testing module imports...</div>';

                try {
                    // Test SVG.js import
                    const SVG = await import(
                        'https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.2.0/dist/svg.esm.js'
                    ).then(m => m.SVG);
                    if (!SVG) throw new Error('SVG.js failed to load');

                    // Test OpenType.js import
                    const opentype = await import(
                        'https://cdn.jsdelivr.net/npm/opentype.js@1.3.4/dist/opentype.module.js'
                    ).then(m => m.default);
                    if (!opentype) throw new Error('OpenType.js failed to load');

                    statusDiv.innerHTML = `
                    <div class="status success">✅ Module imports successful!</div>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>SVG.js loaded from CDN</li>
                        <li>OpenType.js loaded from CDN</li>
                    </ul>
                `;
                } catch (error) {
                    statusDiv.innerHTML = `<div class="status error">❌ Import failed: ${error.message}</div>`;
                }
            };

            window.testFontWarning = async function () {
                const statusDiv = document.getElementById('font-status');
                const outputDiv = document.getElementById('svg-no-font');

                statusDiv.innerHTML =
                    '<div class="status warning">Testing font warning display...</div>';

                try {
                    // Import the SVG renderer
                    const { SVGSignRenderer } = await import(
                        './apps/thumbnail_slayer/sign-renderer-svg.js'
                    );
                    const renderer = new SVGSignRenderer();

                    // Create test data without setting a font
                    const testItem = {
                        id: 'test-1',
                        locationNumber: '101',
                        message1: 'Office 101',
                        message2: 'John Smith',
                        signType: 'room-id',
                        markerType: 'room-id'
                    };

                    // Render without font (should show text + warning banner)
                    const svgElement = await renderer.renderSignThumbnail(testItem, 300);
                    outputDiv.innerHTML = '';
                    outputDiv.appendChild(svgElement);

                    // Check if warning banner is visible
                    const warningBanner = svgElement.querySelector('.font-warning-banner');
                    const textElements = svgElement.querySelectorAll('text');

                    if (warningBanner && textElements.length > 0) {
                        statusDiv.innerHTML = `
                        <div class="status success">✅ Rendering works correctly!</div>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>Message text displayed: "Office 101" and "John Smith"</li>
                            <li>Red banner at top showing "FONT NOT FOUND"</li>
                            <li>Text is readable using SVG text elements</li>
                            <li>Banner indicates fonts needed for production</li>
                        </ul>
                    `;
                    } else {
                        statusDiv.innerHTML =
                            '<div class="status error">❌ Warning banner or text not found in rendered SVG</div>';
                    }
                } catch (error) {
                    statusDiv.innerHTML = `<div class="status error">❌ Test failed: ${error.message}</div>`;
                    console.error('Font warning test error:', error);
                }
            };

            window.testBothRenderers = async function () {
                const statusDiv = document.getElementById('comparison-status');
                const canvasDiv = document.getElementById('canvas-output');
                const svgDiv = document.getElementById('svg-output');

                statusDiv.innerHTML =
                    '<div class="status warning">Rendering with both renderers...</div>';

                try {
                    // Test data
                    const testItem = {
                        id: 'test-2',
                        locationNumber: '202',
                        message1: 'SVG vs Canvas',
                        message2: 'Comparison Test',
                        signType: 'office',
                        markerType: 'office'
                    };

                    // Import both renderers
                    const [canvasModule, svgModule] = await Promise.all([
                        import('./apps/thumbnail_slayer/sign-renderer.js'),
                        import('./apps/thumbnail_slayer/sign-renderer-svg.js')
                    ]);

                    // Render with Canvas
                    const canvasElement = await canvasModule.renderSignThumbnail(testItem, 250);
                    canvasDiv.innerHTML = '';
                    canvasDiv.appendChild(canvasElement);

                    // Render with SVG
                    const svgElement = await svgModule.renderSignThumbnailSVG(testItem, 250);
                    svgDiv.innerHTML = '';
                    svgDiv.appendChild(svgElement);

                    statusDiv.innerHTML = `
                    <div class="status success">✅ Both renderers working!</div>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>Canvas: Raster-based rendering</li>
                        <li>SVG: Vector-based rendering (scalable)</li>
                        <li>SVG shows font warnings when no font configured</li>
                        <li>Toggle between renderers in Thumbnail Slayer footer</li>
                    </ul>
                `;
                } catch (error) {
                    statusDiv.innerHTML = `<div class="status error">❌ Comparison failed: ${error.message}</div>`;
                    console.error('Renderer comparison error:', error);
                }
            };
        </script>
    </body>
</html>
