<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Texture Pattern Test</title>
        <style>
            body {
                margin: 0;
                padding: 20px;
                background: #1a1a1a;
                color: white;
                font-family: Arial, sans-serif;
            }
            #test-svg {
                background: #333;
                border: 1px solid #555;
            }
            .info {
                margin: 20px 0;
                padding: 15px;
                background: rgba(0, 0, 0, 0.5);
                border-radius: 8px;
            }
            button {
                background: #f07727;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                margin: 5px;
            }
            button:hover {
                background: #ff8838;
            }
            #file-input {
                margin: 10px 0;
            }
        </style>
    </head>
    <body>
        <div class="info">
            <h2>SVG Texture Pattern Test</h2>
            <p>Testing texture pattern rendering with SVG.js</p>
            <input type="file" id="file-input" accept="image/*" />
            <br />
            <button onclick="applyTexture()">Apply Texture to Rectangle</button>
            <button onclick="applyColor()">Apply Solid Color</button>
            <button onclick="resizeRect()">Resize Rectangle</button>
        </div>

        <div id="drawing"></div>

        <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.2.0/dist/svg.min.js"></script>
        <script>
            // Create SVG canvas
            const draw = SVG().addTo('#drawing').size(600, 400);
            draw.node.id = 'test-svg';

            // Create a rectangle
            let rect = draw.rect(200, 150).move(50, 50).fill('#4a90e2');
            rect.addClass('test-rect');

            let currentTexture = null;

            // Handle file upload
            document.getElementById('file-input').addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        currentTexture = event.target.result;
                        console.log('Texture loaded:', currentTexture.substring(0, 50));
                    };
                    reader.readAsDataURL(file);
                }
            });

            function applyTexture() {
                if (!currentTexture) {
                    alert('Please select an image file first');
                    return;
                }

                console.log('Applying texture...');

                // Remove old pattern if exists
                const oldPattern = draw.defs().findOne('#testPattern');
                if (oldPattern) {
                    oldPattern.remove();
                    console.log('Removed old pattern');
                }

                // Create new pattern
                const pattern = draw.pattern(200, 150, function (add) {
                    add.image(currentTexture).size(200, 150);
                });
                pattern.id('testPattern');
                pattern.attr('patternUnits', 'userSpaceOnUse');

                // Apply pattern to rectangle
                rect.fill('url(#testPattern)');

                console.log('Pattern applied to rectangle');

                // Log pattern details
                const patternElement = document.getElementById('testPattern');
                if (patternElement) {
                    console.log('Pattern found in DOM:', patternElement);
                    console.log('Pattern HTML:', patternElement.outerHTML);
                }
            }

            function applyColor() {
                rect.fill('#e74c3c');
                console.log('Solid color applied');
            }

            function resizeRect() {
                const newWidth = 100 + Math.random() * 200;
                const newHeight = 100 + Math.random() * 150;
                rect.size(newWidth, newHeight);

                // If texture is applied, update pattern size
                if (rect.attr('fill') && rect.attr('fill').includes('url(#testPattern)')) {
                    const pattern = draw.defs().findOne('#testPattern');
                    if (pattern) {
                        // Remove and recreate pattern with new size
                        pattern.remove();
                        const newPattern = draw.pattern(newWidth, newHeight, function (add) {
                            add.image(currentTexture).size(newWidth, newHeight);
                        });
                        newPattern.id('testPattern');
                        newPattern.attr('patternUnits', 'userSpaceOnUse');
                        rect.fill('url(#testPattern)');
                        console.log('Pattern resized to:', newWidth, newHeight);
                    }
                }

                console.log('Rectangle resized to:', newWidth, newHeight);
            }
        </script>
    </body>
</html>
