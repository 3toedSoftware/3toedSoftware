<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapping Slayer - PDF Sign Mapping Software</title>
    <!-- Supabase JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        /* All existing CSS from your page is preserved here */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Cambria, serif;
            background-color: #1B1C1D;
            color: #ffffff;
            line-height: 1.6;
        }
        
        /* --- START: Demo-Specific Styles --- */
        .demo-area {
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10+ */
            user-select: none; /* Standard syntax */
            padding: 15px;
            background-color: #1B1C1D;
        }

        .demo-header {
            font-size: 18px;
            color: #ff6600;
            margin-bottom: 15px;
            text-align: center;
        }

        .demo-disclaimer {
            text-align: center;
            font-style: italic;
            color: #ccc;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .demo-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .demo-map-column {
            position: relative; /* For positioning controls */
            flex-shrink: 0;
        }
        
        .demo-map-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1002;
        }

        .demo-map-controls .btn {
            padding: 5px 10px;
            font-size: 12px;
            background-color: #6c757d;
            border: 1px solid #888;
        }
        .demo-map-controls .btn.active {
            background-color: #007acc;
        }


        .demo-controls-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 215px;
        }

        .demo-pdf-page {
            position: relative;
            width: 500px;
            height: 300px;
            border: 1px solid #888; /* Hairline */
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><rect width="20" height="20" fill="%231B1C1D"/><rect width="1" height="20" fill="%23333537"/><rect width="20" height="1" fill="%23333537"/></svg>');
            overflow: hidden;
            cursor: pointer;
        }

        .demo-room-text {
            position: absolute;
            color: #ffffff;
            font-family: Arial, sans-serif;
            font-size: 14px;
            padding: 2px 4px;
            pointer-events: none;
        }
        
        .demo-project-legend {
            border: 1px solid #555; /* Hairline */
            padding: 10px;
            background-color: #333537;
        }
        
        .demo-legend-header {
            font-weight: bold;
            color: #ff6600;
            margin-bottom: 10px;
            text-align: center;
        }

        .demo-legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .demo-legend-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            border: 1px solid #fff;
            flex-shrink: 0;
        }

        .demo-legend-text {
            font-size: 18px;
            flex-grow: 1;
        }
        .demo-legend-count {
            font-size: 18px;
        }

        .demo-instructions {
            text-align: left;
            font-size: 14px;
            color: #aaa;
            font-style: italic;
            line-height: 1.5;
        }

        .demo-reset-btn {
            display: block;
            padding: 8px 16px;
            background-color: #6c757d;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            align-self: flex-start; /* Left-aligned */
        }
        .demo-reset-btn:hover {
            background-color: #5a6268;
        }
        
        .selection-box, .scrape-box {
            position: absolute;
            background: rgba(255, 102, 0, 0.1);
            pointer-events: none;
            z-index: 1001;
        }
        .scrape-box {
            border: 2px dashed #ff6600;
        }
        .selection-box {
             border: 2px dashed #00ff88;
             background: rgba(0, 255, 136, 0.1);
        }
        
        .demo-dot {
            position: absolute;
            width: 24px;
            height: 24px;
            color: white;
            border: 1px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.2s;
            z-index: 1000;
        }
        
        .demo-dot-message {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            white-space: nowrap;
            margin-top: 5px;
            display: none;
        }
        .demo-dot-message.visible {
            display: block;
        }

        .demo-dot.selected {
            box-shadow: 0 0 12px #ff6600, 0 0 6px #ff6600;
            border-color: #ff6600;
            transform: translate(-50%, -50%) scale(1.1);
        }

        .demo-footer-note {
            font-size: 14px; /* Updated size */
            color: #aaa;
            font-style: italic;
            margin-top: 15px;
            text-align: center;
        }

        /* --- Automation/Operations Demo Styles --- */
        .automap-demo-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .automap-demo-btn {
            padding: 10px 20px;
            font-family: Cambria, serif;
            font-size: 16px;
            cursor: pointer;
            border: 1px solid #888;
            background-color: #6c757d;
            color: white;
            transition: all 0.3s ease;
        }
        .automap-demo-btn:disabled {
            background-color: #4a4a4a;
            color: #888;
            cursor: not-allowed;
        }
        .automap-demo-btn:not(:disabled):hover {
            background-color: #5a6268;
        }

        .automap-input {
            padding: 8px 12px;
            border: 1px solid #888;
            background-color: #444;
            color: white;
            font-family: Cambria, serif;
            font-size: 16px;
            width: 200px;
        }

        .automap-status {
            font-size: 14px;
            color: #00ff88;
            min-width: 150px;
            text-align: left;
        }

        .automap-status.error {
            color: #ff6b6b;
        }

        .automap-demo-btn.glow {
            background-color: #00b360;
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 136, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); }
        }

        .automap-modal-overlay, .automap-alert-modal, .edit-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .automap-alert-modal, .edit-modal-overlay { z-index: 3000; }

        .automap-modal-content {
            background-color: #f0f0f0;
            color: #000;
            font-family: 'Segoe UI', sans-serif;
            width: 600px;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .automap-modal-header {
            padding: 10px;
            background-color: #e1e1e1;
            border-bottom: 1px solid #ccc;
            font-size: 14px;
        }
        .automap-modal-body { padding: 20px; border-bottom: 1px solid #ccc; }
        .automap-modal-body input { width: 100%; padding: 5px; border: 1px solid #999; }
        .automap-modal-footer { padding: 10px; background-color: #f0f0f0; text-align: right; }
        .automap-modal-footer button { padding: 5px 15px; margin-left: 10px; border: 1px solid #999; background-color: #e1e1e1; cursor: pointer; }

        .automap-notification {
            display: none;
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: rgba(42, 42, 42, 0.9);
            color: #fff;
            padding: 15px 20px;
            border-radius: 5px;
            border-left: 5px solid #00ff88;
            z-index: 2001;
            font-size: 16px;
            align-items: center;
            gap: 15px;
        }
        .automap-notification.visible { display: flex; }
        .automap-notification .check { font-size: 24px; color: #00ff88; }
        
        .automap-alert-content, .edit-modal-content {
            background-color: #333537;
            padding: 30px;
            border-radius: 5px;
            border: 1px solid #555;
            text-align: center;
            width: 90%;
            max-width: 400px;
        }
        .automap-alert-content p { margin-bottom: 20px; }
        .automap-alert-content button { padding: 10px 20px; }

        .edit-modal-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #00ff88;
        }
        .edit-modal-subheader {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 20px;
        }
        .edit-modal-form .form-group {
            text-align: left;
            margin-bottom: 15px;
        }
        .edit-modal-form .form-label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
        }
        .edit-modal-form .form-input {
            width: 100%;
            padding: 8px;
            background: #444;
            border: 1px solid #888;
            color: white;
            border-radius: 4px;
        }
        .edit-modal-buttons {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 25px;
        }
        .edit-modal-buttons .btn-danger { background-color: #dc3545; }
        .edit-modal-buttons .right-buttons { display: flex; gap: 10px; flex-grow: 1;}
        .edit-modal-buttons .right-buttons .btn { flex-grow: 1; }
        .edit-modal-buttons .btn-secondary { background-color: #6c757d; }
        .edit-modal-buttons .btn-primary { background-color: #007acc; }


        .sign-type-selector .demo-legend-item {
            cursor: pointer;
            transition: background-color 0.2s;
            padding: 5px;
            border-radius: 3px;
        }
        .sign-type-selector .demo-legend-item:hover {
            background-color: #444648;
        }
        .sign-type-selector .demo-legend-item.active {
            background-color: #ff6600;
            color: white;
        }
        
        /* --- END: Demo-Specific Styles --- */

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            padding: 20px 0;
            border-bottom: 1px solid #555; /* Hairline */
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #ff6600;
        }

        .logo-svg {
            width: 280px; /* Change this value to your desired width */
            height: auto; /* 'auto' maintains the aspect ratio */
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            align-items: center; /* Vertically align items */
        }

        .btn {
            padding: 12px 24px;
            background-color: transparent;
            color: #ffffff;
            border: 1px solid #e6e6e6; /* Hairline */
            font-family: Cambria, serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background-color: #444648;
        }

        .btn-primary {
            background-color: #ff6600;
            border-color: #ff6600;
            color: #ffffff;
        }

        .btn-primary:hover {
            background-color: #e55a00;
        }
        
        /* NEW: User status display */
        .user-status {
            color: #ccc;
            font-size: 14px;
        }

        /* NEW: Hide elements by default */
        .logged-in, .logged-out {
            display: none;
        }

        .hero {
            padding: 60px 0;
            text-align: center;
        }

        .hero h1, .section-title {
            font-size: 72px;
            color: #ff6600;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .hero-subtitle {
            font-size: 36px;
            color: #ffffff;
            margin-bottom: 20px;
            font-style: italic;
        }

        .hero p:not(.hero-subtitle) {
            font-size: 24px;
            margin-bottom: 40px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .hero .btn {
            font-size: 18px;
            padding: 15px 30px;
        }

        .testimonials-banner {
            background-color: #333537;
            padding: 20px 0;
            overflow: hidden;
            position: relative;
            margin: 40px 0;
        }

        .testimonials-scroll {
            display: flex;
            animation: scroll 80s linear infinite;
            gap: 80px;
            min-width: fit-content;
        }

        .testimonials-scroll:hover {
            animation-play-state: paused;
        }

        .testimonial {
            white-space: nowrap;
            font-size: 18px;
            font-style: italic;
            flex-shrink: 0;
        }

        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .main-content {
            padding: 60px 0;
        }

        .section {
            margin-bottom: 60px;
        }

        .section h2 {
            text-align: center;
        }
        
        .section h3 {
            color: #ff6600;
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: normal;
        }

        .section p {
            font-size: 18px;
            margin-bottom: 15px;
        }

        .arsenal-stack {
            display: flex;
            flex-direction: column;
            gap: 40px;
            margin-top: 30px;
        }

        .arsenal-box {
            background-color: transparent;
            padding: 40px;
            border: none;
            border-top: 1px solid #555;
            border-bottom: 1px solid #555;
            width: 100%;
            max-width: none;
        }

        .arsenal-box:first-child {
            border-top: none;
        }
        .arsenal-box:last-child {
            border-bottom: none;
        }


        .arsenal-box h4 {
            color: #ff6600;
            font-size: 32px;
            margin-bottom: 20px;
            font-weight: bold;
            text-align: center;
        }

        .arsenal-box ul {
            list-style: none;
            padding-left: 0;
            text-align: center;
            margin-bottom: 30px;
        }

        .arsenal-box li {
            margin-bottom: 12px;
            position: relative;
            padding-left: 0;
            font-size: 20px;
            line-height: 1.4;
        }

        .pricing {
            text-align: center;
            background-color: #333537;
            padding: 60px 40px;
            margin: 60px 0;
            border: 1px solid #555; /* Hairline */
        }

        .pricing h2 {
            font-size: 36px;
            margin-bottom: 20px;
        }

        .price {
            font-size: 48px;
            color: #ff6600;
            font-weight: bold;
            margin: 20px 0;
        }

        .pricing-features {
            max-width: 600px;
            margin: 30px auto;
            text-align: left;
        }

        .pricing-features ul {
            list-style: none;
            padding: 0;
        }

        .pricing-features li {
            margin: 10px 0;
            position: relative;
            padding-left: 0;
        }

        .pricing-features li:before {
            content: "✓";
            color: #ff6600;
            font-weight: bold;
            margin-right: 10px;
        }

        footer {
            border-top: 1px solid #555; /* Hairline */
            padding: 40px 0;
            text-align: center;
        }

        footer p {
            color: #e6e6e6;
            font-size: 16px;
        }

        /* MODAL STYLES UPDATED */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex; /* Show when active */
        }

        .modal-content {
            background-color: #333537;
            padding: 25px 30px;
            border: 1px solid #e6e6e6; /* Hairline */
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #e6e6e6;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #ff6600;
        }

        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #ff6600;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            background-color: #2A2C2E;
            border: 1px solid #e6e6e6; /* Hairline */
            color: #ffffff;
            font-family: Cambria, serif;
            font-size: 16px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #ff6600;
        }

        /* NEW: Auth error message style */
        .auth-error {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: -10px;
            margin-bottom: 15px;
            text-align: left;
            min-height: 20px;
        }

        .gallery-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
        }

        .gallery-modal-content {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 90%;
            height: 90%;
        }

        #galleryImage {
            max-width: 100%;
            max-height: 100%;
            display: block;
        }

        .gallery-prev, .gallery-next {
            cursor: pointer;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            padding: 16px;
            color: white;
            font-weight: bold;
            font-size: 30px;
            transition: 0.3s ease;
            user-select: none;
            background-color: rgba(0,0,0,0.3);
        }

        .gallery-prev {
            left: 0;
            border-radius: 0 3px 3px 0;
        }

        .gallery-next {
            right: 0;
            border-radius: 3px 0 0 3px;
        }

        .gallery-prev:hover, .gallery-next:hover {
            background-color: rgba(0,0,0,0.7);
        }

        @media (max-width: 768px) {
            .hero h1, .section-title { font-size: 48px; }
            .hero p { font-size: 20px; }
            .hero-buttons { flex-direction: column; align-items: center; }
            .header-content { flex-direction: column; gap: 20px; }
            .nav-buttons { justify-content: center; }
            .testimonial { font-size: 16px; }
            .demo-pdf-page { width: 100%; max-width: 500px; }
        }
    </style>
</head>
<body>
    <!-- Access Denied Banner -->
    <div id="access-denied-banner" style="display: none; background-color: #e55a00; color: white; text-align: center; padding: 10px; font-size: 16px; font-family: Cambria, serif;">
        Please log in and subscribe to access the full application.
    </div>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="app-title">
                    <img src="MSLogo.svg" alt="Mapping Slayer" class="logo-svg">
                </div>
                <div class="nav-buttons">
                    <button class="btn" onclick="window.location.href='demo.html'">Free Demo in Browser</button>
                    <!-- Logged Out Buttons -->
                    <div class="logged-out">
                        <button class="btn" id="login-button">Login</button>
                        <button class="btn btn-primary" id="signup-button">Sign Up</button>
                    </div>
                    <!-- Logged In Buttons -->
                    <div class="logged-in">
                        <span id="user-status" class="user-status"></span>
                        <button class="btn btn-primary" onclick="window.location.href='mapping_slayer.html'">Launch Mapping Slayer</button>
                        <button class="btn" id="logout-button">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>MAPPING SUCKS!</h1>
            <p class="hero-subtitle">Slay it! with Mapping Slayer</p>
            <p>Transform static floor plans into interactive signage layouts. Plan, document, and manage sign placement with precision and efficiency <strong style="color: #ff6600;">in record time</strong>.</p>
            <div class="hero-buttons">
                <button class="btn btn-primary" onclick="window.location.href='demo.html'">Free Demo in Browser</button>
                <button class="btn" id="subscribe-button">Start Subscription - $11.11/month</button>
            </div>
            <p style="font-size: 16px; margin-top: 20px; font-style: italic;">There is only one tier: SLAY!</p>
            <p style="font-size: 16px; margin-top: 5px;">No hidden fees. No long-term commitment. All functionality. All future updates.</p>
        </div>
    </section>

    <!-- Testimonials Banner -->
    <div class="testimonials-banner">
        <div class="testimonials-scroll">
            <div class="testimonial">"That little program turned a typical sixteen-hour takeoff into two hours."</div>
            <div class="testimonial">"We automatically mapped 80% of the job. Incredible."</div>
            <div class="testimonial">"We got our ADA sign counts in an hour for a twelve-story building."</div>
            <div class="testimonial">"It makes mapping fun."</div>
            <div class="testimonial">"That scrape function is really cool! It makes my job so much easier."</div>
            <div class="testimonial">"I love using the Slayer!"</div>
            <div class="testimonial">"The ROI is incredible!"</div>
            <div class="testimonial">"Fastest program I've used for takeoffs, hands down."</div>
            <div class="testimonial">"Mapping Slayer is a beast!"</div>
            <!-- Duplicate set for seamless loop -->
            <div class="testimonial">"That little program turned a typical sixteen-hour takeoff into two hours."</div>
            <div class="testimonial">"We automatically mapped 80% of the job. Incredible."</div>
            <div class="testimonial">"We got our ADA sign counts in an hour for a twelve-story building."</div>
            <div class="testimonial">"It makes mapping fun."</div>
            <div class="testimonial">"That scrape function is really cool! It makes my job so much easier."</div>
            <div class="testimonial">"I love using the Slayer!"</div>
            <div class="testimonial">"The ROI is incredible!"</div>
            <div class="testimonial">"Fastest program I've used for takeoffs, hands down."</div>
            <div class="testimonial">"Mapping Slayer is a beast!"</div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Features Section -->
            <section class="section">
                <h2 class="section-title">THE SLAYER'S ARSENAL</h2>
                <div class="arsenal-stack">
                    <div class="arsenal-box">
                        <h4>Scrape Function = Turbo Speed</h4>
                        <ul>
                            <li>Shift + right-mouse then drag a box around text to instantly create a map marker,<br>add it to the sign list and update the quantities, all in one movement.</li>
                        </ul>
                        <div class="demo-header">Try it yourself:</div>
                        <p class="demo-disclaimer">This demo is to showcase the Scrape function only.</p>
                        <div class="demo-area">
                            <div class="demo-container">
                                <div class="demo-map-column">
                                    <div class="demo-pdf-page" id="demo-pdf-page-scrape">
                                        <div class="demo-room-text" style="top: 15%; left: 15%;">Conference Room A</div>
                                        <div class="demo-room-text" style="top: 35%; left: 55%;">Men's Restroom</div>
                                        <div class="demo-room-text" style="top: 15%; left: 75%;">Exit</div>
                                        <div class="demo-room-text" style="top: 55%; left: 25%;">Office 101</div>
                                        <div class="demo-room-text" style="top: 75%; left: 65%;">Office 102</div>
                                        <div class="demo-room-text" style="top: 75%; left: 15%;">Women</div>
                                    </div>
                                </div>
                                <div class="demo-controls-column">
                                    <div class="demo-project-legend">
                                        <div class="demo-legend-header">PROJECT LEGEND</div>
                                        <div class="demo-legend-item">
                                            <div class="demo-legend-dot" style="background-color: #F72020;"></div>
                                            <span class="demo-legend-text">I.1</span>
                                            <span class="demo-legend-count" id="scrape-legend-count">0</span>
                                        </div>
                                    </div>
                                    <div class="demo-instructions">
                                        <div>*Left click dots to select</div>
                                        <div>*Delete key to remove selected</div>
                                        <div>*Click reset button below to remove dots...</div>
                                    </div>
                                    <button class="demo-reset-btn" onclick="scrapeDemo.reset()">Reset</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="arsenal-box">
                        <h4>Mapping Automation</h4>
                        <ul>
                            <li>Enter a room name, then click automap to search for that term and place dots automatically.</li>
                        </ul>
                        <div class="demo-header">Try it yourself:</div>
                        <p class="demo-disclaimer">This demo is to showcase the Automap function only.</p>
                        <div class="demo-area">
                            <div class="automap-demo-controls">
                                <input type="text" class="automap-input" id="automap-text-input" placeholder="Enter room name...">
                                <button class="automap-demo-btn" id="automap-it-btn">AUTOMAP IT!</button>
                                <span class="automap-status" id="automap-status"></span>
                            </div>
                            <div class="demo-container">
                                <div class="demo-map-column">
                                    <div class="demo-pdf-page" id="demo-pdf-page-automap">
                                        <!-- Office -->
                                        <div class="demo-room-text" data-category="office" style="top: 5%; left: 10%;">Office</div>
                                        <div class="demo-room-text" data-category="office" style="top: 5%; left: 30%;">Office</div>
                                        <div class="demo-room-text" data-category="office" style="top: 5%; left: 50%;">Office</div>
                                        <div class="demo-room-text" data-category="office" style="top: 5%; left: 70%;">Office</div>
                                        <div class="demo-room-text" data-category="office" style="top: 20%; left: 15%;">Office</div>
                                        <div class="demo-room-text" data-category="office" style="top: 20%; left: 45%;">Office</div>
                                        <div class="demo-room-text" data-category="office" style="top: 20%; left: 75%;">Office</div>
                                        
                                        <!-- Restroom -->
                                        <div class="demo-room-text" data-category="restroom" style="top: 35%; left: 10%;">Restroom</div>
                                        <div class="demo-room-text" data-category="restroom" style="top: 35%; left: 30%;">Restroom</div>
                                        <div class="demo-room-text" data-category="restroom" style="top: 35%; left: 50%;">Restroom</div>
                                        <div class="demo-room-text" data-category="restroom" style="top: 35%; left: 70%;">Restroom</div>
                                        <div class="demo-room-text" data-category="restroom" style="top: 50%; left: 20%;">Restroom</div>
                                        
                                        <!-- Electrical -->
                                        <div class="demo-room-text" data-category="electrical" style="top: 65%; left: 10%;">Electrical</div>
                                        <div class="demo-room-text" data-category="electrical" style="top: 65%; left: 30%;">Electrical</div>
                                        <div class="demo-room-text" data-category="electrical" style="top: 65%; left: 50%;">Electrical</div>
                                        <div class="demo-room-text" data-category="electrical" style="top: 65%; left: 70%;">Electrical</div>
                                        <div class="demo-room-text" data-category="electrical" style="top: 80%; left: 15%;">Electrical</div>
                                        
                                        <!-- Exit -->
                                        <div class="demo-room-text" data-category="exit" style="top: 90%; left: 20%;">Exit</div>
                                        <div class="demo-room-text" data-category="exit" style="top: 90%; left: 40%;">Exit</div>
                                        <div class="demo-room-text" data-category="exit" style="top: 90%; left: 60%;">Exit</div>
                                    </div>
                                </div>
                                <div class="demo-controls-column">
                                    <div class="demo-project-legend">
                                        <div class="demo-legend-header">PROJECT LEGEND</div>
                                        <div class="demo-legend-item">
                                            <div class="demo-legend-dot" style="background-color: #F72020;"></div>
                                            <span class="demo-legend-text">I.1</span>
                                            <span class="demo-legend-count" id="automap-legend-count">0</span>
                                        </div>
                                    </div>
                                    <div class="demo-instructions">
                                        <div><strong>Try searching for:</strong></div>
                                        <div>• "Office"</div>
                                        <div>• "Restroom"</div>
                                        <div>• "Electrical"</div>
                                        <div>• "Exit"</div>
                                        <br>
                                        <div>*Left click dots to select</div>
                                        <div>*Delete key to remove selected</div>
                                    </div>
                                    <button class="demo-reset-btn" onclick="newAutomapDemo.reset()">Reset</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="arsenal-box">
                        <h4>Simple Bulk Operations</h4>
                        <ul>
                            <li>Select a sign type from the legend, click to add dots of that color, shift-drag to select multiple,<br>and right-click any dot in your selection to edit in bulk.</li>
                        </ul>
                         <div class="demo-header">Try it yourself:</div>
                        <p class="demo-disclaimer">This demo showcases manual dot placement and bulk changes.</p>
                        <div class="demo-area">
                            <div class="demo-container">
                                <div class="demo-map-column">
                                    <div class="demo-pdf-page" id="demo-pdf-page-operations">
                                    </div>
                                </div>
                                <div class="demo-controls-column">
                                    <div class="demo-project-legend sign-type-selector">
                                        <div class="demo-legend-header">SELECT SIGN TYPE</div>
                                        <div id="operations-legend-items"></div>
                                    </div>
                                    <button class="demo-reset-btn" onclick="operationsDemo.reset()">Reset</button>
                                </div>
                            </div>
                            <p class="demo-footer-note">*The number inside each dot is its unique Location ID. New dots get the next available ID, and deleting a dot removes its ID permanently.</p>
                        </div>
                    </div>
                    
                    <div class="arsenal-box">
                        <h4>Spreadsheet Power Integration</h4>
                        <ul>
                            <li>Export to CSV for bulk editing.</li>
                            <li>Work faster in Excel/Google Sheets if you prefer.</li>
                            <li>Import back to update all dots at once.</li>
                            <li>Bulk updates for hundreds of signs in seconds!</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>
    </main>
    
    <!-- Footer, Modals etc. -->
    <div id="footer-and-modals">

        <!-- Edit Location Modal -->
        <div id="edit-location-modal" class="edit-modal-overlay">
            <div class="edit-modal-content">
                <div class="edit-modal-header">Edit Location</div>
                <div class="edit-modal-subheader">Update location details</div>
                <form id="edit-location-form" class="edit-modal-form">
                    <div class="form-group">
                        <label class="form-label">Sign Type</label>
                        <select id="edit-sign-type" class="form-input"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Message</label>
                        <input type="text" id="edit-message" class="form-input">
                    </div>
                    <div class="edit-modal-buttons">
                        <button type="button" id="edit-delete-btn" class="btn btn-danger">DELETE</button>
                        <div class="right-buttons">
                            <button type="button" id="edit-cancel-btn" class="btn btn-secondary">CANCEL</button>
                            <button type="submit" class="btn btn-primary">UPDATE</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Group Edit Modal -->
        <div id="group-edit-modal" class="edit-modal-overlay">
            <div class="edit-modal-content">
                <div class="edit-modal-header">Edit Multiple Locations</div>
                <div class="edit-modal-subheader" id="group-edit-subheader">(0 selected)</div>
                <form id="group-edit-form" class="edit-modal-form">
                    <div class="form-group">
                        <label class="form-label">Sign Type</label>
                        <select id="group-edit-sign-type" class="form-input"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Message</label>
                        <input type="text" id="group-edit-message" class="form-input">
                    </div>
                    <div class="edit-modal-buttons">
                        <button type="button" id="group-delete-btn" class="btn btn-danger">DELETE ALL</button>
                        <div class="right-buttons">
                            <button type="button" id="group-cancel-btn" class="btn btn-secondary">CANCEL</button>
                            <button type="submit" class="btn btn-primary">UPDATE ALL</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- System Requirements Section -->
        <section class="section">
            <div class="container">
                <h3 style="text-align: center;">System Requirements</h3>
                <ul style="list-style: none; padding: 0; text-align: center; font-size: 16px; line-height: 1.8;">
                    <li>✓ Modern web browser (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)</li>
                    <li>✓ JavaScript enabled</li>
                    <li>✓ Minimum 4GB RAM recommended for large PDF files</li>
                    <li>✓ Stable internet connection for initial loading</li>
                    <li>✓ Local file access permissions (for PDF upload/download)</li>
                </ul>
            </div>
        </section>
        
        <!-- Footer -->
        <footer>
            <div class="container">
                <p>&copy; 2025 Mapping Slayer. Questions? Ideas for new features? Email me directly - I'm building this to make your job easier and I read every customer message.</p>
            </div>
        </footer>
    </div>


    <!-- NEW: Auth Modals -->
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-login">&times;</span>
            <h2 style="color: #ff6600; margin-bottom: 20px;">Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <div id="login-error" class="auth-error"></div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Login</button>
            </form>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id="signupModal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-signup">&times;</span>
            <p style="font-size: 16px; margin-top: 5px; margin-bottom: 10px; font-style: italic;">This will create a<br>3toed Software Account<br>for access to Mapping Slayer</p>
            <form id="signupForm">
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" required>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" required>
                </div>
                <div class="form-group">
                    <label for="signupPasswordConfirm">Confirm Password</label>
                    <input type="password" id="signupPasswordConfirm" required>
                </div>
                <div id="signup-error" class="auth-error"></div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 15px;">Sign Up</button>
            </form>
        </div>
    </div>


    <script>
        // --- START: SUPABASE & STRIPE CONFIG ---
        // --- IMPORTANT: PASTE YOUR KEYS HERE ---
        const SUPABASE_URL = 'https://apmrjfzlbhncygmbhzbh.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwbXJqZnpsYmhuY3lnbWJoemJoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0MTcwMjEsImV4cCI6MjA2Nzk5MzAyMX0.R0SWhl3mtGveMA5klvTZP2S4mLxd-aXQFDnYAjcfIN4';

        const STRIPE_PUBLISHABLE_KEY = 'pk_test_51RkCbXAcN7hZsXp1qDPU61Y58IBv1Xw1OBArb1lZcMUc3rtfkEWKDQMJv6A9AhjraAkUaB6YWChOrV3erVEwJAVn00yLcdX0eO';
        const PRICE_ID = 'price_1RkDG5AcN7hZsXp1QdikMksw';
        // ------------------------------------
        
        // --- Add a validation check for keys ---
        if (!SUPABASE_URL || SUPABASE_URL.includes('PASTE_YOUR_SUPABASE_URL_HERE') || 
            !SUPABASE_ANON_KEY || SUPABASE_ANON_KEY.includes('PASTE_YOUR_SUPABASE_ANON_KEY_HERE')) {
            
            // We can't use a custom modal here because the script might stop before the DOM is ready.
            // An alert is the most reliable way to show this critical error.
            alert('Configuration Error: Supabase API keys are missing. Please paste your Supabase URL and Anon Key into the script section of the mapping_slayer_landing.html file.');
            
            // Stop the script from running further to prevent more errors.
            throw new Error('Supabase credentials are not set in the script.'); 
        }

        const { createClient } = supabase;
        const _supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const stripe = Stripe(STRIPE_PUBLISHABLE_KEY);

        // --- UI Elements ---
        const loggedInElements = document.querySelectorAll('.logged-in');
        const loggedOutElements = document.querySelectorAll('.logged-out');
        const userStatusElement = document.getElementById('user-status');
        const logoutButton = document.getElementById('logout-button');
        const loginButton = document.getElementById('login-button');
        const signupButton = document.getElementById('signup-button');
        const subscribeButton = document.getElementById('subscribe-button');
        
        const loginModal = document.getElementById('loginModal');
        const signupModal = document.getElementById('signupModal');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const closeLogin = document.getElementById('close-login');
        const closeSignup = document.getElementById('close-signup');
        const loginError = document.getElementById('login-error');
        const signupError = document.getElementById('signup-error');

        // --- Auth State Management ---
        _supabase.auth.onAuthStateChange((event, session) => {
            updateUI(session);
        });
        
        // Check initial session
        async function checkSession() {
            const { data: { session } } = await _supabase.auth.getSession();
            updateUI(session);
        }
        checkSession();


        function updateUI(session) {
            if (session) {
                // User is logged in
                loggedInElements.forEach(el => el.style.display = 'flex');
                loggedOutElements.forEach(el => el.style.display = 'none');
                userStatusElement.textContent = session.user.email;
            } else {
                // User is logged out
                loggedInElements.forEach(el => el.style.display = 'none');
                loggedOutElements.forEach(el => el.style.display = 'flex');
                userStatusElement.textContent = '';
            }
        }

        // --- Event Listeners ---
        logoutButton.addEventListener('click', async () => {
            await _supabase.auth.signOut();
        });

        loginButton.addEventListener('click', () => {
            loginModal.classList.add('active');
        });

        signupButton.addEventListener('click', () => {
            signupModal.classList.add('active');
        });

        closeLogin.addEventListener('click', () => loginModal.classList.remove('active'));
        closeSignup.addEventListener('click', () => signupModal.classList.remove('active'));
        window.addEventListener('click', (event) => {
            if (event.target == loginModal) loginModal.classList.remove('active');
            if (event.target == signupModal) signupModal.classList.remove('active');
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            loginError.textContent = '';
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const { error } = await _supabase.auth.signInWithPassword({ email, password });
            if (error) {
                loginError.textContent = error.message;
            } else {
                loginModal.classList.remove('active');
            }
        });

        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            signupError.textContent = '';
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            // UPDATED: Get the confirm password value
            const passwordConfirm = document.getElementById('signupPasswordConfirm').value;
            
            // UPDATED: Check if passwords match
            if (password !== passwordConfirm) {
                signupError.textContent = 'Passwords do not match.';
                return; // Stop the function if they don't match
            }

            const { error } = await _supabase.auth.signUp({ email, password });
            if (error) {
                signupError.textContent = error.message;
            } else {
                signupModal.classList.remove('active');
                alert('Success! Please check your email for a verification link.');
            }
        });

        // --- Stripe Checkout Logic ---
        subscribeButton.addEventListener('click', async () => {
            const { data: { session } } = await _supabase.auth.getSession();

            if (!session) {
                alert('Please sign up or log in before subscribing.');
                signupModal.classList.add('active');
                return;
            }

            subscribeButton.disabled = true;
            subscribeButton.textContent = 'Redirecting...';

            stripe.redirectToCheckout({
                lineItems: [{ price: PRICE_ID, quantity: 1 }],
                mode: 'subscription',
                customerEmail: session.user.email,
                // The client_reference_id has been removed as it's not supported for subscriptions here.
                successUrl: `https://3toedsoftware.com/mapping-slayer/success.html?session_id={CHECKOUT_SESSION_ID}`,
                cancelUrl: 'https://3toedsoftware.com/mapping-slayer/mapping_slayer_landing.html',
            })
            .then(function (result) {
                if (result.error) {
                    alert(result.error.message);
                    subscribeButton.disabled = false;
                    subscribeButton.textContent = 'Start Subscription - $11.11/month';
                }
            });
        });

        // --- START: COMPLETE DEMO LOGIC ---
        class Demo {
            constructor(mapId, legendContainerId, signTypes = null) {
                this.mapPage = document.getElementById(mapId);
                this.legendContainer = typeof legendContainerId === 'string' ? document.getElementById(legendContainerId) : legendContainerId;
                this.signTypes = signTypes;
                this.state = {
                    dots: [],
                    selectedDots: new Set(),
                    nextId: 1,
                    isScraping: false,
                    isSelecting: false,
                    boxEl: null,
                    boxStart: { x: 0, y: 0 },
                    activeSignType: null,
                    messagesVisible: false,
                    editingDotId: null
                };

                this.mapPage.addEventListener('contextmenu', e => e.preventDefault());
                if (this.signTypes) {
                    this.initializeLegend();
                }
            }

            initializeLegend() {
                if (!this.legendContainer) return;
                this.legendContainer.innerHTML = '';
                let isFirst = true;
                for (const typeKey in this.signTypes) {
                    const type = this.signTypes[typeKey];
                    const item = document.createElement('div');
                    item.className = 'demo-legend-item';
                    item.dataset.signTypeKey = typeKey;
                    item.innerHTML = `
                        <div class="demo-legend-dot" style="background-color: ${type.color};"></div>
                        <span class="demo-legend-text">${type.name}</span>
                        <span class="demo-legend-count" id="legend-count-${this.mapPage.id}-${type.name}">0</span>
                    `;
                    this.legendContainer.appendChild(item);

                    if (this.mapPage.id.includes('operations')) {
                        if (isFirst) {
                            item.classList.add('active');
                            this.state.activeSignType = type;
                            isFirst = false;
                        }
                        item.addEventListener('click', () => this.setActiveSignType(item, type));
                    }
                }
            }

            setActiveSignType(selectedItem, type) {
                this.legendContainer.querySelectorAll('.demo-legend-item').forEach(item => item.classList.remove('active'));
                selectedItem.classList.add('active');
                this.state.activeSignType = type;
            }

            isCollision(newX, newY) {
                const minDistance = 25;
                for (const dot of this.state.dots) {
                    const distance = Math.sqrt(Math.pow(dot.x - newX, 2) + Math.pow(dot.y - newY, 2));
                    if (distance < minDistance) return true;
                }
                return false;
            }

            addDot(x, y, signType = null) {
                const dotId = this.state.nextId++;
                if (this.isCollision(x, y)) return null;

                const dot = { id: dotId, x, y, signType, message: 'Location Name' };
                this.state.dots.push(dot);

                const dotEl = document.createElement('div');
                dotEl.className = 'demo-dot';
                dotEl.dataset.id = dotId;
                dotEl.style.left = `${x}px`;
                dotEl.style.top = `${y}px`;
                
                const dotColor = (signType && signType.color) ? signType.color : '#F72020';
                dotEl.style.backgroundColor = dotColor;

                dotEl.innerHTML = `
                    ${dotId}
                    <div class="demo-dot-message visible" style="color: ${dotColor};">${dot.message}</div>
                `;
                
                dotEl.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.handleDotClick(e, dotId, dotEl);
                });

                dotEl.addEventListener('contextmenu', (e) => {
                    e.stopPropagation();
                    e.preventDefault();
                    if (this.mapPage.id.includes('operations')) {
                        operationsDemo.handleRightClick(dotId);
                    }
                });
                
                this.mapPage.appendChild(dotEl);
                this.updateLegend();
                return dotEl;
            }

            handleDotClick(e, id, el) {
                if (e.shiftKey) {
                    this.toggleDotSelection(id, el);
                } else {
                    this.clearSelection();
                    this.toggleDotSelection(id, el);
                }
            }

            toggleDotSelection(id, el) {
                if (this.state.selectedDots.has(id)) {
                    this.state.selectedDots.delete(id);
                    el.classList.remove('selected');
                } else {
                    this.state.selectedDots.add(id);
                    el.classList.add('selected');
                }
            }

            deleteSelectedDots() {
                if (this.state.selectedDots.size === 0) return;
                this.state.selectedDots.forEach(id => {
                    const dotEl = this.mapPage.querySelector(`.demo-dot[data-id='${id}']`);
                    if (dotEl) dotEl.remove();
                });
                this.state.dots = this.state.dots.filter(dot => !this.state.selectedDots.has(dot.id));
                this.state.selectedDots.clear();
                this.updateLegend();
            }
            
            clearSelection() {
                 this.state.selectedDots.forEach(id => {
                    const dotEl = this.mapPage.querySelector(`.demo-dot[data-id='${id}']`);
                    if (dotEl) dotEl.classList.remove('selected');
                });
                this.state.selectedDots.clear();
            }

            updateLegend() {
                if (this.signTypes) {
                    for (const typeKey in this.signTypes) {
                        const type = this.signTypes[typeKey];
                        const count = this.state.dots.filter(d => d.signType && d.signType.name === type.name).length;
                        const countEl = document.getElementById(`legend-count-${this.mapPage.id}-${type.name}`);
                        if (countEl) countEl.textContent = count;
                    }
                } else {
                    // This handles the scrape demo legend
                    const scrapeLegend = document.getElementById('scrape-legend-count');
                    if (scrapeLegend) scrapeLegend.textContent = this.state.dots.length;
                }
            }

            reset() {
                this.mapPage.querySelectorAll('.demo-dot').forEach(el => el.remove());
                this.state.dots = [];
                this.state.selectedDots.clear();
                this.state.nextId = 1;
                this.updateLegend();
                if (this.signTypes && this.mapPage.id.includes('operations')) {
                    this.initializeLegend();
                }
            }

            startBox(e, type) {
                if (this.state.isScraping || this.state.isSelecting) return;
                
                if (type === 'scrape') this.state.isScraping = true;
                if (type === 'select') this.state.isSelecting = true;

                const rect = this.mapPage.getBoundingClientRect();
                this.state.boxStart.x = e.clientX - rect.left;
                this.state.boxStart.y = e.clientY - rect.top;

                this.state.boxEl = document.createElement('div');
                this.state.boxEl.className = type === 'scrape' ? 'scrape-box' : 'selection-box';
                this.state.boxEl.style.left = `${this.state.boxStart.x}px`;
                this.state.boxEl.style.top = `${this.state.boxStart.y}px`;
                this.mapPage.appendChild(this.state.boxEl);
            }

            updateBox(e) {
                if (!this.state.isScraping && !this.state.isSelecting) return;
                const rect = this.mapPage.getBoundingClientRect();
                const currentX = e.clientX - rect.left;
                const currentY = e.clientY - rect.top;
                const left = Math.min(this.state.boxStart.x, currentX);
                const top = Math.min(this.state.boxStart.y, currentY);
                const width = Math.abs(currentX - this.state.boxStart.x);
                const height = Math.abs(currentY - this.state.boxStart.y);
                Object.assign(this.state.boxEl.style, { left: `${left}px`, top: `${top}px`, width: `${width}px`, height: `${height}px` });
            }

            finishScrape() {
                if (!this.state.isScraping) return;
                const scrapeRect = this.state.boxEl.getBoundingClientRect();
                const textElements = this.mapPage.querySelectorAll('.demo-room-text');

                for (const textEl of textElements) {
                    const textRect = textEl.getBoundingClientRect();
                    const overlap = !(scrapeRect.right < textRect.left || scrapeRect.left > textRect.right || scrapeRect.bottom < textRect.top || scrapeRect.top > textRect.bottom);
                    if (overlap) {
                        const dotX = textEl.offsetLeft + textEl.offsetWidth / 2;
                        const dotY = textEl.offsetTop + textEl.offsetHeight / 2;
                        this.addDot(dotX, dotY);
                        break; // Stop after finding the first match
                    }
                }
                
                this.state.boxEl.remove();
                this.state.isScraping = false;
            }

            finishSelection() {
                if (!this.state.isSelecting) return;
                const selectRect = this.state.boxEl.getBoundingClientRect();
                this.mapPage.querySelectorAll('.demo-dot').forEach(dotEl => {
                    const dotRect = dotEl.getBoundingClientRect();
                    const overlap = !(selectRect.right < dotRect.left || selectRect.left > textRect.right || selectRect.bottom < dotRect.top || selectRect.top > dotRect.bottom);
                    if (overlap) {
                        const dotId = parseInt(dotEl.dataset.id);
                        if (!this.state.selectedDots.has(dotId)) {
                            this.toggleDotSelection(dotId, dotEl);
                        }
                    }
                });
                this.state.boxEl.remove();
                this.state.isSelecting = false;
            }

            toggleMessages(forceState) {
                // Messages are always visible in operations demo
                this.mapPage.querySelectorAll('.demo-dot-message').forEach(msg => {
                    msg.classList.add('visible');
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const automapSignTypes = {
                'Exit':       { name: 'I.1', color: '#F72020' },
                'Restroom':   { name: 'I.2', color: '#4DA1B3' },
                'Conference': { name: 'I.4', color: '#FF9500' },
                'Office':     { name: 'I.5', color: '#F8E677' }
            };

            // --- Initialize Demos ---
            const scrapeDemo = new Demo('demo-pdf-page-scrape');
            const operationsDemo = new Demo('demo-pdf-page-operations', document.getElementById('operations-legend-items'), automapSignTypes);
            window.scrapeDemo = scrapeDemo;
            window.operationsDemo = operationsDemo;

            // --- Scrape Demo Listeners ---
            scrapeDemo.mapPage.addEventListener('mousedown', (e) => {
                if (e.shiftKey && e.button === 2) {
                    e.preventDefault();
                    scrapeDemo.startBox(e, 'scrape');
                } else if (e.target === scrapeDemo.mapPage) {
                    scrapeDemo.clearSelection();
                }
            });
            document.addEventListener('mousemove', (e) => {
                scrapeDemo.updateBox(e);
                operationsDemo.updateBox(e);
            });
            document.addEventListener('mouseup', () => {
                scrapeDemo.finishScrape();
                operationsDemo.finishSelection();
            });

            // --- Automap Demo Listeners & Logic ---
            setupAutomapDemo();

            // --- Operations Demo Listeners ---
            setupOperationsDemo();

            // --- Global Keydown Listener for Deletion ---
            window.addEventListener('keydown', (e) => {
                if (e.key === 'Delete' || e.key === 'Backspace') {
                    scrapeDemo.deleteSelectedDots();
                    if (window.newAutomapDemo) newAutomapDemo.deleteSelectedDots();
                    operationsDemo.deleteSelectedDots();
                }
            });

            function setupAutomapDemo() {
                class NewAutomapDemo {
                    constructor() {
                        this.mapPage = document.getElementById('demo-pdf-page-automap');
                        this.statusEl = document.getElementById('automap-status');
                        this.legendCountEl = document.getElementById('automap-legend-count');
                        this.state = {
                            dots: [],
                            selectedDots: new Set(),
                            nextId: 1
                        };

                        this.setupEventListeners();
                    }

                    setupEventListeners() {
                        const automapBtn = document.getElementById('automap-it-btn');
                        const textInput = document.getElementById('automap-text-input');

                        automapBtn.addEventListener('click', () => this.performAutomap());
                        textInput.addEventListener('keydown', (e) => {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                                this.performAutomap();
                            }
                        });

                        this.mapPage.addEventListener('click', (e) => {
                            if (e.target === this.mapPage) {
                                this.clearSelection();
                            }
                        });
                    }

                    performAutomap() {
                        const searchTerm = document.getElementById('automap-text-input').value.trim().toLowerCase();
                        
                        if (!searchTerm) {
                            this.updateStatus('Please enter a room name to find.', true);
                            return;
                        }

                        const textElements = this.mapPage.querySelectorAll('.demo-room-text');
                        let matchesFound = 0;
                        let collisionsFound = 0;
                        let totalMatches = 0;

                        textElements.forEach(textEl => {
                            const roomText = textEl.textContent.toLowerCase();
                            
                            if (roomText.includes(searchTerm)) {
                                totalMatches++;
                                const centerX = textEl.offsetLeft + textEl.offsetWidth / 2;
                                const centerY = textEl.offsetTop + textEl.offsetHeight / 2;
                                
                                if (!this.isCollision(centerX, centerY)) {
                                    this.addDot(centerX, centerY, textEl.textContent);
                                    matchesFound++;
                                } else {
                                    collisionsFound++;
                                }
                            }
                        });

                        if (matchesFound > 0) {
                            this.updateStatus(`Found ${matchesFound} match(es) for "${searchTerm}"!`, false);
                            document.getElementById('automap-text-input').value = '';
                        } else if (collisionsFound > 0 && totalMatches > 0) {
                            this.updateStatus(`Location markers are already placed within these bounds. Try selecting and deleting dots first.`, true);
                        } else {
                            this.updateStatus(`No matches found for "${searchTerm}".`, true);
                        }
                    }

                    isCollision(newX, newY) {
                        const minDistance = 25;
                        for (const dot of this.state.dots) {
                            const distance = Math.sqrt(Math.pow(dot.x - newX, 2) + Math.pow(dot.y - newY, 2));
                            if (distance < minDistance) return true;
                        }
                        return false;
                    }

                    addDot(x, y, message) {
                        const dotId = this.state.nextId++;
                        const dot = { id: dotId, x, y, message };
                        this.state.dots.push(dot);

                        const dotEl = document.createElement('div');
                        dotEl.className = 'demo-dot';
                        dotEl.dataset.id = dotId;
                        dotEl.style.left = `${x}px`;
                        dotEl.style.top = `${y}px`;
                        dotEl.style.backgroundColor = '#F72020';
                        dotEl.textContent = dotId;

                        dotEl.addEventListener('click', (e) => {
                            e.stopPropagation();
                            this.handleDotClick(dotId, dotEl, e.shiftKey);
                        });

                        this.mapPage.appendChild(dotEl);
                        this.updateLegend();
                    }

                    handleDotClick(id, el, isShiftClick) {
                        if (isShiftClick) {
                            this.toggleDotSelection(id, el);
                        } else {
                            this.clearSelection();
                            this.toggleDotSelection(id, el);
                        }
                    }

                    toggleDotSelection(id, el) {
                        if (this.state.selectedDots.has(id)) {
                            this.state.selectedDots.delete(id);
                            el.classList.remove('selected');
                        } else {
                            this.state.selectedDots.add(id);
                            el.classList.add('selected');
                        }
                    }

                    clearSelection() {
                        this.state.selectedDots.forEach(id => {
                            const dotEl = this.mapPage.querySelector(`.demo-dot[data-id='${id}']`);
                            if (dotEl) dotEl.classList.remove('selected');
                        });
                        this.state.selectedDots.clear();
                    }

                    deleteSelectedDots() {
                        if (this.state.selectedDots.size === 0) return;
                        
                        this.state.selectedDots.forEach(id => {
                            const dotEl = this.mapPage.querySelector(`.demo-dot[data-id='${id}']`);
                            if (dotEl) dotEl.remove();
                        });
                        
                        this.state.dots = this.state.dots.filter(dot => !this.state.selectedDots.has(dot.id));
                        this.state.selectedDots.clear();
                        this.updateLegend();
                    }

                    updateLegend() {
                        this.legendCountEl.textContent = this.state.dots.length;
                    }

                    updateStatus(message, isError = false) {
                        this.statusEl.textContent = message;
                        this.statusEl.className = isError ? 'automap-status error' : 'automap-status';

                        if (message) {
                            setTimeout(() => {
                                if (this.statusEl.textContent === message) {
                                    this.statusEl.textContent = '';
                                }
                            }, 5000);
                        }
                    }

                    reset() {
                        this.mapPage.querySelectorAll('.demo-dot').forEach(el => el.remove());
                        this.state.dots = [];
                        this.state.selectedDots.clear();
                        this.state.nextId = 1;
                        this.updateLegend();
                        this.statusEl.textContent = '';
                        document.getElementById('automap-text-input').value = '';
                    }
                }

                window.newAutomapDemo = new NewAutomapDemo();
            }

            function setupOperationsDemo() {
                operationsDemo.mapPage.addEventListener('mousedown', (e) => {
                    if (e.shiftKey && !e.target.classList.contains('demo-dot')) { // Shift + Left Click for selection box
                        e.preventDefault();
                        operationsDemo.startBox(e, 'select');
                    } else if (e.target === operationsDemo.mapPage) {
                        if (operationsDemo.state.selectedDots.size > 0) {
                            operationsDemo.clearSelection();
                        } else {
                            const rect = operationsDemo.mapPage.getBoundingClientRect();
                            const x = e.clientX - rect.left;
                            const y = e.clientY - rect.top;
                            operationsDemo.addDot(x, y, operationsDemo.state.activeSignType);
                        }
                    }
                });

                // --- Edit Modal Logic ---
                const editModal = document.getElementById('edit-location-modal');
                const groupEditModal = document.getElementById('group-edit-modal');

                operationsDemo.handleRightClick = function(dotId) {
                    const isMultiSelect = this.state.selectedDots.size > 1 && this.state.selectedDots.has(dotId);
                    if (isMultiSelect) {
                        this.openGroupEditModal();
                    } else {
                        this.clearSelection();
                        const dotEl = this.mapPage.querySelector(`.demo-dot[data-id='${dotId}']`);
                        this.toggleDotSelection(dotId, dotEl);
                        this.openEditModal(dotId);
                    }
                }

                operationsDemo.openEditModal = function(dotId) {
                    this.state.editingDotId = dotId;
                    const dot = this.state.dots.find(d => d.id === dotId);
                    if (!dot || !dot.signType) return; // Add guard for corrupted dot

                    const select = document.getElementById('edit-sign-type');
                    select.innerHTML = Object.values(this.signTypes).map(t => `<option value="${t.name}" ${t.name === dot.signType.name ? 'selected' : ''}>${t.name}</option>`).join('');
                    document.getElementById('edit-message').value = dot.message;
                    editModal.style.display = 'flex';
                }
                
                operationsDemo.openGroupEditModal = function() {
                    document.getElementById('group-edit-subheader').textContent = `(${this.state.selectedDots.size} selected)`;
                    const select = document.getElementById('group-edit-sign-type');
                    select.innerHTML = '<option value="">-- Keep Individual Types --</option>' + Object.values(this.signTypes).map(t => `<option value="${t.name}">${t.name}</option>`).join('');
                    document.getElementById('group-edit-message').value = '';
                    groupEditModal.style.display = 'flex';
                }

                document.getElementById('edit-location-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const dotId = operationsDemo.state.editingDotId;
                    const dot = operationsDemo.state.dots.find(d => d.id === dotId);
                    if (!dot) return; // Exit if dot not found

                    const newSignTypeName = document.getElementById('edit-sign-type').value;
                    const newSignType = Object.values(operationsDemo.signTypes).find(t => t.name === newSignTypeName);
                    
                    dot.message = document.getElementById('edit-message').value;

                    if (newSignType) {
                        dot.signType = newSignType;
                    }
                    
                    operationsDemo.updateDotVisuals(dot);
                    editModal.style.display = 'none';
                });

                document.getElementById('group-edit-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const newSignTypeName = document.getElementById('group-edit-sign-type').value;
                    const newSignType = newSignTypeName ? Object.values(operationsDemo.signTypes).find(t => t.name === newSignTypeName) : null;
                    const newMessage = document.getElementById('group-edit-message').value;

                    operationsDemo.state.selectedDots.forEach(dotId => {
                        const dot = operationsDemo.state.dots.find(d => d.id === dotId);
                        if (!dot) return;
                        if (newSignType) dot.signType = newSignType;
                        if (newMessage) dot.message = newMessage;
                        operationsDemo.updateDotVisuals(dot);
                    });
                    groupEditModal.style.display = 'none';
                });
                
                operationsDemo.updateDotVisuals = function(dot) {
                    const dotEl = this.mapPage.querySelector(`.demo-dot[data-id='${dot.id}']`);
                    if (!dotEl || !dot.signType) return;
                    const msgEl = dotEl.querySelector('.demo-dot-message');
                    dotEl.style.backgroundColor = dot.signType.color;
                    msgEl.style.color = dot.signType.color;
                    msgEl.textContent = dot.message;
                    msgEl.classList.add('visible');
                    this.updateLegend();
                }

                // Modal Cancel/Delete Buttons
                document.getElementById('edit-cancel-btn').addEventListener('click', () => editModal.style.display = 'none');
                document.getElementById('group-cancel-btn').addEventListener('click', () => groupEditModal.style.display = 'none');
                document.getElementById('edit-delete-btn').addEventListener('click', () => {
                    operationsDemo.deleteSelectedDots();
                    editModal.style.display = 'none';
                });
                document.getElementById('group-delete-btn').addEventListener('click', () => {
                    operationsDemo.deleteSelectedDots();
                    groupEditModal.style.display = 'none';
                });
                
                // Add initial dot
                operationsDemo.addDot(100, 150, operationsDemo.state.activeSignType);
            }
            
        });
        // --- END: COMPLETE DEMO LOGIC ---
        // --- START: Access Denied Banner Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const reason = urlParams.get('reason');

            if (reason === 'unsubscribed') {
                const banner = document.getElementById('access-denied-banner');
                if (banner) {
                    banner.style.display = 'block';
                }

                // Optional: Automatically open the login modal for a smoother flow
                const loginModal = document.getElementById('loginModal');
                if (loginModal) {
                    loginModal.classList.add('active');
                }
            }
        });
        // --- END: Access Denied Banner Logic ---
    </script>
</body>
</html>
