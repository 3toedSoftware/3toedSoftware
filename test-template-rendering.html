<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Template Rendering Test - Thumbnail Slayer</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                padding: 20px;
                background: #1a1a1a;
                color: #fff;
            }
            .test-container {
                max-width: 1200px;
                margin: 0 auto;
            }
            .test-section {
                margin: 30px 0;
                padding: 20px;
                background: #2a2a2a;
                border-radius: 8px;
            }
            .thumbnail-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-top: 20px;
            }
            .thumbnail-item {
                background: #333;
                padding: 15px;
                border-radius: 8px;
                text-align: center;
            }
            .thumbnail-item h4 {
                margin-top: 0;
                color: #4caf50;
            }
            .thumbnail-output {
                background: white;
                border: 2px solid #555;
                margin: 10px 0;
                display: inline-block;
            }
            .status {
                padding: 10px;
                border-radius: 4px;
                margin: 10px 0;
            }
            .status.success {
                background: #2d5a2d;
            }
            .status.error {
                background: #5a2d2d;
            }
            .status.warning {
                background: #5a4f2d;
            }
            button {
                background: #4caf50;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                margin: 5px;
            }
            button:hover {
                background: #45a049;
            }
            .properties {
                text-align: left;
                font-size: 12px;
                margin-top: 10px;
                color: #ccc;
            }
        </style>
    </head>
    <body>
        <div class="test-container">
            <h1>Template Rendering Test Suite</h1>
            <p>Testing template scaling, color preservation, and text positioning improvements.</p>

            <div class="test-section">
                <h2>Test 1: Mock Template with Proper Scaling</h2>
                <button onclick="testMockTemplate()">Test Mock Template</button>
                <div id="mock-status"></div>
                <div class="thumbnail-grid" id="mock-thumbnails"></div>
            </div>

            <div class="test-section">
                <h2>Test 2: Color Preservation</h2>
                <button onclick="testColorPreservation()">Test Color Preservation</button>
                <div id="color-status"></div>
                <div class="thumbnail-grid" id="color-thumbnails"></div>
            </div>

            <div class="test-section">
                <h2>Test 3: Text Scaling and Positioning</h2>
                <button onclick="testTextScaling()">Test Text Scaling</button>
                <div id="text-status"></div>
                <div class="thumbnail-grid" id="text-thumbnails"></div>
            </div>
        </div>

        <script type="module">
            // Test mock template rendering with proper scaling
            window.testMockTemplate = async function () {
                const statusDiv = document.getElementById('mock-status');
                const thumbnailGrid = document.getElementById('mock-thumbnails');

                statusDiv.innerHTML =
                    '<div class="status warning">Testing mock template with improved scaling...</div>';
                thumbnailGrid.innerHTML = '';

                try {
                    // Import the SVG renderer
                    const { SVGSignRenderer } = await import(
                        './apps/thumbnail_slayer/sign-renderer-svg.js'
                    );
                    const renderer = new SVGSignRenderer();

                    // Create a mock template that represents Design Slayer data
                    const mockTemplate = {
                        id: 'test-template-1',
                        name: 'Room ID Template',
                        signTypeCode: 'room-id',
                        backgroundColor: '#003366',
                        layers: [
                            {
                                type: 'plate',
                                name: 'Background Plate',
                                x: 0,
                                y: 0,
                                width: 300,
                                height: 150,
                                backgroundColor: '#003366',
                                color: '#003366',
                                zIndex: 0
                            },
                            {
                                type: 'text',
                                name: 'Room Number',
                                x: 50,
                                y: 30,
                                width: 200,
                                height: 50,
                                text: '{{message}}',
                                fieldName: 'message',
                                fontSize: 32,
                                fontColor: '#ffffff',
                                textColor: '#ffffff',
                                fontFamily: 'Arial',
                                textAlign: 'center',
                                zIndex: 1
                            },
                            {
                                type: 'text',
                                name: 'Room Name',
                                x: 50,
                                y: 90,
                                width: 200,
                                height: 30,
                                text: '{{message2}}',
                                fieldName: 'message2',
                                fontSize: 16,
                                fontColor: '#cccccc',
                                textColor: '#cccccc',
                                fontFamily: 'Arial',
                                textAlign: 'center',
                                zIndex: 1
                            }
                        ]
                    };

                    // Test data
                    const testItems = [
                        {
                            id: 'test-1',
                            message: '101',
                            message2: 'Conference Room',
                            signType: 'room-id'
                        },
                        {
                            id: 'test-2',
                            message: '202A',
                            message2: 'John Smith Office',
                            signType: 'room-id'
                        }
                    ];

                    // Render thumbnails
                    for (const item of testItems) {
                        const thumbnailDiv = document.createElement('div');
                        thumbnailDiv.className = 'thumbnail-item';

                        // Create SVG drawing surface
                        const draw = renderer.createSVGDraw(200);

                        // Render with mock template
                        await renderer.renderFromTemplate(draw, mockTemplate, item, 200);

                        thumbnailDiv.innerHTML = `
                        <h4>Room ${item.message}</h4>
                        <div class="thumbnail-output"></div>
                        <div class="properties">
                            Message: ${item.message}<br>
                            Subtitle: ${item.message2}<br>
                            Template: ${mockTemplate.name}
                        </div>
                    `;

                        const outputDiv = thumbnailDiv.querySelector('.thumbnail-output');
                        outputDiv.appendChild(draw.node);

                        thumbnailGrid.appendChild(thumbnailDiv);
                    }

                    statusDiv.innerHTML = `
                    <div class="status success">✅ Mock template rendering successful!</div>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>Template bounds properly calculated</li>
                        <li>Content scales to fill thumbnail area</li>
                        <li>Colors preserved from template data</li>
                        <li>Text properly positioned and scaled</li>
                    </ul>
                `;
                } catch (error) {
                    statusDiv.innerHTML = `<div class="status error">❌ Test failed: ${error.message}</div>`;
                    console.error('Mock template test error:', error);
                }
            };

            // Test helper functions are now part of the renderer class

            // Test color preservation
            window.testColorPreservation = async function () {
                const statusDiv = document.getElementById('color-status');
                const thumbnailGrid = document.getElementById('color-thumbnails');

                statusDiv.innerHTML =
                    '<div class="status warning">Testing color preservation...</div>';
                thumbnailGrid.innerHTML = '';

                try {
                    const { SVGSignRenderer } = await import(
                        './apps/thumbnail_slayer/sign-renderer-svg.js'
                    );
                    const renderer = new SVGSignRenderer();

                    const colorTests = [
                        {
                            name: 'Blue Plate Template',
                            backgroundColor: '#003366',
                            textColor: '#ffffff',
                            message: 'Blue Test'
                        },
                        {
                            name: 'Green Plate Template',
                            backgroundColor: '#2d5a2d',
                            textColor: '#ffffff',
                            message: 'Green Test'
                        },
                        {
                            name: 'Orange Plate Template',
                            backgroundColor: '#ff6600',
                            textColor: '#000000',
                            message: 'Orange Test'
                        }
                    ];

                    for (const test of colorTests) {
                        const mockTemplate = {
                            id: `color-test-${test.name}`,
                            name: test.name,
                            backgroundColor: test.backgroundColor,
                            layers: [
                                {
                                    type: 'plate',
                                    x: 0,
                                    y: 0,
                                    width: 200,
                                    height: 100,
                                    backgroundColor: test.backgroundColor,
                                    color: test.backgroundColor
                                },
                                {
                                    type: 'text',
                                    x: 20,
                                    y: 30,
                                    width: 160,
                                    height: 40,
                                    text: test.message,
                                    fontSize: 24,
                                    fontColor: test.textColor,
                                    textAlign: 'center'
                                }
                            ]
                        };

                        const thumbnailDiv = document.createElement('div');
                        thumbnailDiv.className = 'thumbnail-item';

                        const draw = renderer.createSVGDraw(200);
                        await renderer.renderFromTemplate(
                            draw,
                            mockTemplate,
                            { message: test.message },
                            200
                        );

                        thumbnailDiv.innerHTML = `
                        <h4>${test.name}</h4>
                        <div class="thumbnail-output"></div>
                        <div class="properties">
                            Background: ${test.backgroundColor}<br>
                            Text Color: ${test.textColor}
                        </div>
                    `;

                        thumbnailDiv.querySelector('.thumbnail-output').appendChild(draw.node);
                        thumbnailGrid.appendChild(thumbnailDiv);
                    }

                    statusDiv.innerHTML = `
                    <div class="status success">✅ Color preservation test complete!</div>
                    <p>Each thumbnail should show the specified background and text colors.</p>
                `;
                } catch (error) {
                    statusDiv.innerHTML = `<div class="status error">❌ Color test failed: ${error.message}</div>`;
                    console.error('Color preservation test error:', error);
                }
            };

            // Test text scaling
            window.testTextScaling = async function () {
                const statusDiv = document.getElementById('text-status');
                const thumbnailGrid = document.getElementById('text-thumbnails');

                statusDiv.innerHTML =
                    '<div class="status warning">Testing text scaling and positioning...</div>';
                thumbnailGrid.innerHTML = '';

                try {
                    const { SVGSignRenderer } = await import(
                        './apps/thumbnail_slayer/sign-renderer-svg.js'
                    );
                    const renderer = new SVGSignRenderer();

                    const textTests = [
                        { align: 'left', size: 24, text: 'Left Aligned Text' },
                        { align: 'center', size: 20, text: 'Center Aligned' },
                        { align: 'right', size: 16, text: 'Right Aligned Text' }
                    ];

                    for (const test of textTests) {
                        const mockTemplate = {
                            id: `text-test-${test.align}`,
                            backgroundColor: '#f0f0f0',
                            layers: [
                                {
                                    type: 'plate',
                                    x: 0,
                                    y: 0,
                                    width: 250,
                                    height: 100,
                                    backgroundColor: '#f0f0f0'
                                },
                                {
                                    type: 'text',
                                    x: 10,
                                    y: 30,
                                    width: 230,
                                    height: 40,
                                    text: test.text,
                                    fontSize: test.size,
                                    fontColor: '#333333',
                                    textAlign: test.align
                                }
                            ]
                        };

                        const thumbnailDiv = document.createElement('div');
                        thumbnailDiv.className = 'thumbnail-item';

                        const draw = renderer.createSVGDraw(200);
                        await renderer.renderFromTemplate(draw, mockTemplate, {}, 200);

                        thumbnailDiv.innerHTML = `
                        <h4>${test.align.toUpperCase()} Alignment</h4>
                        <div class="thumbnail-output"></div>
                        <div class="properties">
                            Alignment: ${test.align}<br>
                            Font Size: ${test.size}px
                        </div>
                    `;

                        thumbnailDiv.querySelector('.thumbnail-output').appendChild(draw.node);
                        thumbnailGrid.appendChild(thumbnailDiv);
                    }

                    statusDiv.innerHTML = `
                    <div class="status success">✅ Text scaling test complete!</div>
                    <p>Text should be properly aligned and scaled within the thumbnail bounds.</p>
                `;
                } catch (error) {
                    statusDiv.innerHTML = `<div class="status error">❌ Text scaling test failed: ${error.message}</div>`;
                    console.error('Text scaling test error:', error);
                }
            };
        </script>
    </body>
</html>
